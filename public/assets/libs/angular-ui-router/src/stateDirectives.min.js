function parseStateRef(e,t){var n=e.match(/^\s*({[^}]*})\s*$/),r;n&&(e=t+"("+n[1]+")");r=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!r||r.length!==4)throw new Error("Invalid state ref '"+e+"'");return{state:r[1],paramExpr:r[3]||null}}function stateContext(e){var t=e.parent().inheritedData("$uiView");if(t&&t.state&&t.state.name)return t.state}function $StateRefDirective(e,t){var n=["location","inherit","reload"];return{restrict:"A",require:["?^uiSrefActive","?^uiSrefActiveEq"],link:function(r,i,s,o){var u=parseStateRef(s.uiSref,e.current.name),a=null,f=null,l=stateContext(i)||e.$current,c=null,h=i.prop("tagName")==="A",p=i[0].nodeName==="FORM",d=p?"action":"href",v=!0,m={relative:l,inherit:!0},g=r.$eval(s.uiSrefOpts)||{};angular.forEach(n,function(e){e in g&&(m[e]=g[e])});var y=function(t){t&&(a=angular.copy(t));if(!v)return;c=e.href(u.state,a,m);var n=o[1]||o[0];n&&n.$$setStateInfo(u.state,a);if(c===null){v=!1;return!1}s.$set(d,c)};if(u.paramExpr){r.$watch(u.paramExpr,function(e,t){e!==a&&y(e)},!0);a=angular.copy(r.$eval(u.paramExpr))}y();if(p)return;i.bind("click",function(n){var r=n.which||n.button;if(!(r>1||n.ctrlKey||n.metaKey||n.shiftKey||i.attr("target"))){var s=t(function(){e.go(u.state,a,m)});n.preventDefault();var o=h&&!c?1:0;n.preventDefault=function(){o--<=0&&t.cancel(s)}}})}}}function $StateRefActiveDirective(e,t,n){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,i,s){function f(){l()?i.addClass(a):i.removeClass(a)}function l(){return typeof s.uiSrefActiveEq!="undefined"?e.$current.self===o&&c():o&&e.includes(o.name)&&c()}function c(){return!u||equalForKeys(u,t)}var o,u,a;a=n(s.uiSrefActiveEq||s.uiSrefActive||"",!1)(r);this.$$setStateInfo=function(t,n){o=e.get(t,stateContext(i));u=n;f()};r.$on("$stateChangeSuccess",f)}]}}$StateRefDirective.$inject=["$state","$timeout"];$StateRefActiveDirective.$inject=["$state","$stateParams","$interpolate"];angular.module("ui.router.state").directive("uiSref",$StateRefDirective).directive("uiSrefActive",$StateRefActiveDirective).directive("uiSrefActiveEq",$StateRefActiveDirective);