function UrlMatcher(e,t,n){function c(t,n,r,i){if(f[t])return f[t];if(!/^\w+(-+\w+)*(?:\[\])?$/.test(t))throw new Error("Invalid parameter name '"+t+"' in pattern '"+e+"'");if(l[t])throw new Error("Duplicate parameter name '"+t+"' in pattern '"+e+"'");l[t]=new $$UMFP.Param(t,n,r,i);return l[t]}function h(e,t,n){var r=["",""],i=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return i;switch(n){case!1:r=["(",")"];break;case!0:r=["?(",")?"];break;default:r=["("+n+"|",")?"]}return i+r[0]+t+r[1]}function p(n,r){var i,s,u,a,f,l;i=n[2]||n[3];f=t.params[i];u=e.substring(o,n.index);s=r?n[4]:n[4]||(n[1]=="*"?".*":null);a=$$UMFP.type(s||"string")||inherit($$UMFP.type("string"),{pattern:new RegExp(s)});return{id:i,regexp:s,segment:u,type:a,cfg:f}}t=extend({params:{}},isObject(t)?t:{});var r=/([:*])([\w\[\]]+)|\{([\w\[\]]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,i=/([:]?)([\w\[\]-]+)|\{([\w\[\]-]+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,s="^",o=0,u,a=this.segments=[],f=n?n.params:{},l=this.params=n?n.params.$$new():new $$UMFP.ParamSet;this.source=e;var d,v,m;while(u=r.exec(e)){d=p(u,!1);if(d.segment.indexOf("?")>=0)break;v=c(d.id,d.type,d.cfg,"path");s+=h(d.segment,v.type.pattern.source,v.squash);a.push(d.segment);o=r.lastIndex}m=e.substring(o);var g=m.indexOf("?");if(g>=0){var y=this.sourceSearch=m.substring(g);m=m.substring(0,g);this.sourcePath=e.substring(0,o+g);if(y.length>0){o=0;while(u=i.exec(y)){d=p(u,!0);v=c(d.id,d.type,d.cfg,"search");o=r.lastIndex}}}else{this.sourcePath=e;this.sourceSearch=""}s+=h(m)+(t.strict===!1?"/?":"")+"$";a.push(m);this.regexp=new RegExp(s,t.caseInsensitive?"i":undefined);this.prefix=a[0]}function Type(e){extend(this,e)}function $UrlMatcherFactory(){function r(e){return e!=null?e.toString().replace("/","%2F"):e}function i(e){return e!=null?e.toString().replace("%2F","/"):e}function s(e,t){return angular.equals(e,t)}function o(e){return this.pattern.test(e)}function h(){return{strict:t,caseInsensitive:e}}function p(e){return isFunction(e)||isArray(e)&&isFunction(e[e.length-1])}function d(){while(f.length){var e=f.shift();if(e.pattern)throw new Error("You cannot override a type's .pattern at runtime.");angular.extend(u[e.name],l.invoke(e.def))}}function v(e){extend(this,e||{})}$$UMFP=this;var e=!1,t=!0,n=!1,u={},a=!0,f=[],l,c={string:{encode:r,decode:i,is:o,pattern:/[^/]*/},"int":{encode:r,decode:function(e){return parseInt(e,10)},is:function(e){return isDefined(e)&&this.decode(e.toString())===e},pattern:/\d+/},bool:{encode:function(e){return e?1:0},decode:function(e){return parseInt(e,10)!==0},is:function(e){return e===!0||e===!1},pattern:/0|1/},date:{encode:function(e){return[e.getFullYear(),("0"+(e.getMonth()+1)).slice(-2),("0"+e.getDate()).slice(-2)].join("-")},decode:function(e){return new Date(e)},is:function(e){return e instanceof Date&&!isNaN(e.valueOf())},equals:function(e,t){return e.toISOString()===t.toISOString()},pattern:/[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])/}};$UrlMatcherFactory.$$getDefaultValue=function(e){if(!p(e.value))return e.value;if(!l)throw new Error("Injectable functions cannot be called at configuration time");return l.invoke(e.value)};this.caseInsensitive=function(t){isDefined(t)&&(e=t);return e};this.strictMode=function(e){isDefined(e)&&(t=e);return t};this.defaultSquashPolicy=function(e){if(!isDefined(e))return n;if(e!==!0&&e!==!1&&!isString(e))throw new Error("Invalid squash policy: "+e+". Valid policies: false, true, arbitrary-string");n=e;return e};this.compile=function(e,t){return new UrlMatcher(e,extend(h(),t))};this.isMatcher=function(e){if(!isObject(e))return!1;var t=!0;forEach(UrlMatcher.prototype,function(n,r){isFunction(n)&&(t=t&&isDefined(e[r])&&isFunction(e[r]))});return t};this.type=function(e,t,n){if(!isDefined(t))return u[e];if(u.hasOwnProperty(e))throw new Error("A type named '"+e+"' has already been defined.");u[e]=new Type(extend({name:e},t));if(n){f.push({name:e,def:n});a||d()}return this};forEach(c,function(e,t){u[t]=new Type(extend({name:t},e))});u=inherit(u,{});this.$get=["$injector",function(e){l=e;a=!1;d();forEach(c,function(e,t){u[t]||(u[t]=new Type(e))});return this}];this.Param=function(t,r,i,s){function v(e){var t=isObject(e)?objectKeys(e):[],n=indexOf(t,"value")===-1&&indexOf(t,"type")===-1&&indexOf(t,"squash")===-1&&indexOf(t,"array")===-1,r=n?e:e.value,i={fn:p(r)?r:function(){return i.value},value:r};return i}function m(e,n){if(e.type&&n)throw new Error("Param '"+t+"' has two type configurations.");return n?n:e.type?e.type instanceof Type?e.type:new Type(e.type):u.string}function g(){var e={array:s==="search"?"auto":!1},n=t.match(/\[\]$/)?{array:!0}:{};return extend(e,n,i).array}function y(e,t){var r=e.squash;if(!t||r===!1)return!1;if(!isDefined(r)||r==null)return n;if(r===!0||isString(r))return r;throw new Error("Invalid squash policy: '"+r+"'. Valid policies: false, true, or arbitrary string")}function b(e,t,n,r){var i,s,o=[{from:"",to:n||t?undefined:""},{from:null,to:n||t?undefined:""}];i=isArray(e.replace)?e.replace:[];isString(r)&&i.push({from:r,to:undefined});s=map(i,function(e){return e.from});return filter(o,function(e){return indexOf(s,e.from)===-1}).concat(i)}function w(){if(!l)throw new Error("Injectable functions cannot be called at configuration time");return l.invoke(a.fn)}function E(e){function t(e){return function(t){return t.from===e}}function n(e){var n=map(filter(o.replace,t(e)),function(e){return e.to});return n.length?n[0]:e}e=n(e);return isDefined(e)?o.type.decode(e):w()}function S(){return"{Param:"+t+" "+r+" squash: '"+h+"' optional: "+c+"}"}var o=this,a=v(i);i=i||{};r=m(i,r);var f=g();r=f?r.$asArray(f,s==="search"):r;r.name==="string"&&!f&&s==="path"&&a.value===undefined&&(a.value="");var c=a.value!==undefined,h=y(i,c),d=b(i,f,c,h);extend(this,{id:t,type:r,array:f,config:i,squash:h,replace:d,isOptional:c,dynamic:undefined,value:E,toString:S})};v.prototype={$$new:function(){return inherit(this,extend(new v,{$$parent:this}))},$$keys:function(){var e=[],t=[],n=this,r=objectKeys(v.prototype);while(n){t.push(n);n=n.$$parent}t.reverse();forEach(t,function(t){forEach(objectKeys(t),function(t){indexOf(e,t)===-1&&indexOf(r,t)===-1&&e.push(t)})});return e},$$values:function(e){var t={},n=this;forEach(n.$$keys(),function(r){t[r]=n[r].value(e&&e[r])});return t},$$equals:function(e,t){var n=!0,r=this;forEach(r.$$keys(),function(i){var s=e&&e[i],o=t&&t[i];r[i].type.equals(s,o)||(n=!1)});return n},$$validates:function(t){var n=!0,r,i,s,o=this;forEach(this.$$keys(),function(e){s=o[e];i=t[e];r=!i&&s.isOptional;n=n&&(r||s.type.is(i))});return n},$$parent:undefined};this.ParamSet=v}var $$UMFP;UrlMatcher.prototype.concat=function(e,t){var n={caseInsensitive:$$UMFP.caseInsensitive(),strict:$$UMFP.strictMode(),squash:$$UMFP.defaultSquashPolicy()};return new UrlMatcher(this.sourcePath+e+this.sourceSearch,extend(n,t),this)};UrlMatcher.prototype.toString=function(){return this.source};UrlMatcher.prototype.exec=function(e,t){function c(e){function t(e){return e.split("").reverse().join("")}function n(e){return e.replace(/\\-/,"-")}var r=t(e).split(/-(?!\\)/),i=map(r,t);return map(i,n).reverse()}var n=this.regexp.exec(e);if(!n)return null;t=t||{};var r=this.parameters(),i=r.length,s=this.segments.length-1,o={},u,a,f,l;if(s!==n.length-1)throw new Error("Unbalanced capture group in route '"+this.source+"'");for(u=0;u<s;u++){l=r[u];var h=this.params[l],p=n[u+1];for(a=0;a<h.replace;a++)h.replace[a].from===p&&(p=h.replace[a].to);p&&h.array===!0&&(p=c(p));o[l]=h.value(p)}for(;u<i;u++){l=r[u];o[l]=this.params[l].value(t[l])}return o};UrlMatcher.prototype.parameters=function(e){return isDefined(e)?this.params[e]||null:this.params.$$keys()};UrlMatcher.prototype.validates=function(e){return this.params.$$validates(e)};UrlMatcher.prototype.format=function(e){function f(e){return encodeURIComponent(e).replace(/-/g,function(e){return"%5C%"+e.charCodeAt(0).toString(16).toUpperCase()})}e=e||{};var t=this.segments,n=this.parameters(),r=this.params;if(!this.validates(e))return null;var i,s=!1,o=t.length-1,u=n.length,a=t[0];for(i=0;i<u;i++){var l=i<o,c=n[i],h=r[c],p=h.value(e[c]),d=h.isOptional&&h.type.equals(h.value(),p),v=d?h.squash:!1,m=h.type.encode(p);if(l){var g=t[i+1];if(v===!1){m!=null&&(isArray(m)?a+=map(m,f).join("-"):a+=encodeURIComponent(m));a+=g}else if(v===!0){var y=a.match(/\/$/)?/\/?(.*)/:/(.*)/;a+=g.match(y)[1]}else isString(v)&&(a+=v+g)}else{if(m==null||d&&v!==!1)continue;isArray(m)||(m=[m]);m=map(m,encodeURIComponent).join("&"+c+"=");a+=(s?"&":"?")+(c+"="+m);s=!0}}return a};Type.prototype.is=function(e,t){return!0};Type.prototype.encode=function(e,t){return e};Type.prototype.decode=function(e,t){return e};Type.prototype.equals=function(e,t){return e==t};Type.prototype.$subPattern=function(){var e=this.pattern.toString();return e.substr(1,e.length-2)};Type.prototype.pattern=/.*/;Type.prototype.toString=function(){return"{Type:"+this.name+"}"};Type.prototype.$asArray=function(e,t){function n(e,t){function n(e,t){return function(){return t.apply(e,arguments)}}function r(e,n){return function(i){isArray(i)||(i=[i]);var s=map(i,e);return n?s.reduce(n,!0):s&&s.length==1&&t==="auto"?s[0]:s}}function i(e,t){return e&&t}this.encode=r(n(this,e.encode));this.decode=r(n(this,e.decode));this.equals=r(n(this,e.equals),i);this.is=r(n(this,e.is),i);this.pattern=e.pattern;this.$arrayMode=t}if(!e)return this;if(e==="auto"&&!t)throw new Error("'auto' array mode is for query parameters only");return new n(this,e)};angular.module("ui.router.util").provider("$urlMatcherFactory",$UrlMatcherFactory);angular.module("ui.router.util").run(["$urlMatcherFactory",function(e){}]);